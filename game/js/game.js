const songs = [
	{
    id: "glue",
		title: "Glue Song (feat Clario)- Beabadoobee",
		lyrics:
			"I've never known someone like you,Tangled in love, stuck by you, from the glue Don't forget to kiss me or else you'll have to miss me I guess I'm stuck forever by the glue, oh, and you",
      file: "songs/Glue Song (feat. Clairo).mp3",
     photo: "",
	},
	{

    id: "smile",
		title: "Die With a Smile",
		lyrics:
			"If the world was ending, I'd wanna be next to you If the party was over and our time on Earth was through I'd wanna hold you just for a while and die with a smile If the world was ending, I'd wanna be next to you",
		file: "songs/Lady Gaga, Bruno Mars - Die With A Smile (Official Audio).mp3",
	},
	{
    id: "feeling",
		title: "I've Got A Feeling - The Beatles",
		lyrics:
			"I've got a feeling a feeling deep inside oh yeah oh yeah that's right I've got a feeling a feeling I can't hide oh no no oh no oh no yeah yeah I've got a feeling oh please believe me I'd hate to miss the train oh yeah yeah oh yeah and if you leave me I won't be late again oh no oh no oh no yeah yeah I've got a feeling I've got a feeling all these years I've been wandering around wondering how come nobody told me all that I was looking for was somebody who looked like you I've got a feeling that keeps me on my toes oh yeah oh yeah I've got a feeling I think that everybody knows oh yeah oh yeah oh yeah yeah I've got a feeling yeah everybody had a hard year everybody had a good time everybody had a wet dream everybody saw the sunshine oh yeah oh yeah oh yeah everybody had a good year everybody let their hair down everybody pulled their socks up yeah everybody put their foot down oh yeah everybody had a good year everybody had a hard time everybody had a wet dream everybody saw the sunshine everybody had a good year everybody let their hair down everybody pulled their socks up oh no no everybody put their foot down oh yeah I've got a feeling I've got a feeling oh yeah I've got a feeling...  ",
		file: "videos/I'VE A GOT A FEELING TAKE 1 ï½œ THE BEATLES ROOFTOP CONCERT.mp4",
    videoSize: "575px"
	},
	{
    id: "nature",
		title: "Child of Nature (Esher Demo) - The Beatles",
		lyrics: 
      "On the road to Rishikesh I was dreaming more or less and the dream I had was true yes the dream I had was true I'm just a child of nature I don't need much to set me free I'm just a child of nature I'm one of nature's children sunlight shining in my eyes as I faced the desert sky and my thoughts returned to home yes my thoughts returned to home I'm just a child of nature I don't need much to set me free I'm just a child of nature I'm one of nature's children underneath the mountain ranges where the wind that never changes touched the windows of my soul touched the windows of my soul I'm just a child of nature I don't need much to set me free I'm just a child of nature I'm one of nature's children...",
		file: "songs/Child Of Nature (Esher Demo).mp3",
		photo: "images/ontheroad.jpg",
    photoSize: "500px"
	},
	{
    id: "forget",
		title: "Forget Her - Jeff Buckley",
		lyrics:
			"While this town is busy sleeping, all the noise has died away, I walk the streets to stop my weeping cause she will never change her way. But don't fool yourself, she was heartache from the moment that you met her. Ah, my heart feels so still as I try to find the will To forget her somehow. Oh, I think I've forgotten her now.",
		file: "videos/Jeff Buckley - Forget Her.mp4",
    videoSize: "800px"
  
	},
  {
    id: "what",
    title: "What Ever Happened - The Strokes",
    lyrics: 
     "I wanna be forgotten and I don't wanna be reminded. You say please don't make this harder. No I won't yet.  I wanna be beside her. She wanna be admired, you say please don't make this harder. No I won't yet. Oh dear is it really all true? Did they offend us and they want it to sound true? Top ten ideas for countdown shows, whose culture is this and does anybody know? I wait and tell myself, life ain't chess, but no one comes in and yes, you're alone. You don't miss me, I know. Oh Tennessee what did you write? ",
    file: "songs/What Ever Happened_.mp3",
    photo: "images/strokes2.jpg",
    photoSize: "610px",
  }, 
  {
  id: "everything",
  title: "Everything She Wants - Wham!",
  lyrics: "Ah ha ha. Oh yeah. Work. Somebody told me, boy everything she wants is everything she sees. I guess I must've loved you because I said you were the perfect girl for me, baby. And now we're six months older and everything you want and everything you see, is out of reach not good enough. I don't know what the hell you want from me, oh. Somebody tell me, won't you tell me, why I work so hard for you. ",
  file: "songs/Everything She Wants.mp3",
  photo: "images/wp4296903-wham-wallpapers.jpg",
  photoSize: "610px",
  },

  {
  id: "paperback",
  title: "Paperback Writer - The Beatles",
  lyrics: "Paperback writer dear sir or madam will you read my book it took me years to write will you take a look it's based on a novel by a man named Lear and I need a job so I wanna be a paperback writer paperback writer it's a dirty story of a dirty man and his clinging wife doesn't understand his son is working for the daily mail it's a steady job but he wants to be a paperback writer paperback writer.",
  file: "videos/The Beatles - Paperback Writer.mp4",
  videoSize: "800px",
 
  },

  { 
  id: "rain",
  title: "Rain - The Beatles",
  lyrics: "If the rain comes they run and hide their heads they might as well be dead if the rain comes if the rain comes when the sun shines they slip into the shade and sip their lemonade when the sun shines when the sun shines rain I don't mind shine the weather's fine I can show you that when it starts to rain everything's the same I can show you I can show you rain I don't mind shine the weathers fine can you hear me that when it rains and shine it's just a state of mind can you hear me can you hear me rain...",
  file: "videos/The Beatles - Rain.mp4",
  videoSize: "800px",
  },

  {
  id: "fake",
  title: "Fake Tales of San Francisco - Arctic Monkeys",
  lyrics: "Fake tales of San Francisco echo through the room.",
  file: "videos/Arctic Monkeys - Fake Tales Of San Francisco (Official Video).mp4",
  videoSize: "800px"

  },

  {
  id: "darkness",
  title: "Under Cover of Darkness - The Strokes",
  lyrics: "Slip back outta whack at your best it's a nightmare so I'm joining the army no house phones but can I still call will you wait for me now we got the right to live fight to use it got everything but you can just choose it I won't just be your puppet on a string don't go that way I'll wait for you and I'm tired of all your friends listening at your door and I want what's better for you so long my friend and adversary but I'll wait for you get dressed jump outta bed and do it best are you okay I've been out around this town everybody singing the same song for ten years I'll wait for you will you wait for me too and they sacrificed their lives and they lied about those odds and they said it a million times and they'll say it again so long my adversary and friend don't go that way I'll wait for you I'm tired of all your friends knocking down your door get up in the morning saying no more so long my friend and adversary I'll wait for you...",
  file: "videos/The Strokes - Under Cover of Darkness (Official Video).mp4",
  videoSize: "800px"

  }, 

  { 
  id: "fell",
  title: "If I Fell - The Beatles", 
  lyrics: "If I fell in love with you would you promise to be true and help me understand cause I've been in love before and I found that love was more than just holding hands if I gave my heart to you I must be sure from the very start that you would love me more than her if I trust in you oh please don't run and hide if I love you too oh please don't hurt my pride like her cause I couldn't stand the pain and I would be sad if our new love was in vain so I hope you see that I would love to love you and that she will cry when she learns we are two cause I couldn't stand the pain and I would be sad if our new love was in vain so I hope you see that I would love to love you and that she will cry when she learns we are two if I fell in love with you...",
  file: "songs/If I Fell (Remastered 2009).mp3",
  photo: "images/ififell.jpeg",
  photoSize: "550px"

  }, 
  {
  id: "nowhere",
  title: "Nowhere Man - The Beatles",
  lyrics: "He's a real nowhere man sitting in his nowhere land making all his nowhere plans for nobody doesn't have a point of view knows not where he's going to isn't he a bit like you and me nowhere man please listen you don't know what you're missing nowhere man the world is at your command he's as blind as he can be just sees what he wants to see nowhere man can you see me at all",
  file: "songs/Nowhere Man (Remastered 2009).mp3",
  photo: "images/umbrellabeatles.jpg",
  photoSize: "700px"
  }, 

  {id: "infinity", 
   title: "Infinity Repeating (2013 Demo) - Daft Punk feat. Julian Casablancas + The Voidz", 
   lyrics: "I was crossing the border two old friend coincidence I don't want any other two old friend coincidences weekday weekday weekday I don't wanna play any other game on a simpler day it's not right it's not true it's not right it's not how we used to do it's not true it's not right it's not how we used to do it's not true it's not right it's not how we used to do ",
   file: "videos/Daft Punk - Infinity Repeating (2013 Demo) (feat. Julian Casablancas+The Voidz).mp4"
  },

  { 
    id: "sailor",
    title: "Sailor Song - Gigi Perez",
    lyrics: "Oh, won't you kiss me on the mouth and love me like a sailor? And when you get a taste, can you tell me what's my flavor? I don't believe in God, but I believe that you're my savior My mom says that she's worried, but I'm covered in His favor And when we're getting dirty, I forget all that is wrong I sleep so I can see you 'cause I hate to wait so long I sleep so I can see you and I hate to wait so long",
    file: "songs/Sailor Song.mp3",
    photo: "images/sailor.jpeg",
    photoSize: "640px"
    },

  { 
    id: "blood",
    title: "Bloodline - Alex Warren",
    lyrics: "Oh, my brother You don't have to follow in your bloodline Oh, we got each other And if you got tomorrow, then you still got time To break the chain that left you scarred From where you came isn't who you are Oh, my brother (Oh) You don't have to follow in your bloodline That storm keeps on raging, but don't you forget God's not done with you yet When it feels like you're losing the war in your head Just know this isn't the end",
    file: "songs/Alex Warren - Bloodline.mp3",
    photo: "images/bloodline.jpeg",
    photoSize: "550px"
    },
    { 
      id: "backwards",
      title: "Feels Like We Only Go Backwards - Arctic Monkeys",
      lyrics: "It feels like I only go backwards baby every part of me says go ahead I got my hopes again oh no not again it feels like I only go backwards darling I know that you think you sound silly when you call my name but I get it inside my head all day then I realize I'm just holding on to the hope that maybe your feelings don't show it feels like I only go backwards baby every part of me says go ahead I got my hopes up again oh no not again it feels like I only go backwards darling ",
      file: "videos/FLWOGB.mp4",
      photoSize: "700px",

    },
    {
      id: "jinji",
      title: "My Jinji - Sunset Rollercoaster",
      lyrics: "Every time you lie in my place I do want to say It's you, you my babe It won't be too late Oh, don't leave me behind Without you, I'll cry 'Cause only you, my baby Only you can conquer time Only you can conquer time",
      file:  "songs/Sunset Rollercoaster - My Jinji.mp3",
      photoSize: "500px",   
    },
    {
      id: "vacay",
      title:"Dark Vacay - Cigarettes After Sex",
      lyrics: "So come on, come on, dark star, been loving you and I Can't get enough, dark star, we don't need Brazzers Feel the world around you, feel the world surround you Feel the world around you, feel it all around you crash",
      file: "songs/Dark Vacay - Cigarettes After Sex.mp3",
      photoSize: "500px",
    },
    {
      id: "chihiro",
      title: "CHIHIRO - Billie Eilish",
      lyrics: "Saw your seat at the counter when I looked away Saw you turn around, but it wasn't your face Said, I need to be alone now, I'm takin' a break How come when I returned, you were gone away? I don't, I don't know why I called I don't know you at all I don't know you Not at all I don't, I don't know why I called I don't know you at all I don't know you Did you take My love away From me? Me",
      file:"songs/Billie Eilish - CHIHIRO (Audio).mp3",
      photoSize: "500px",
    },
    {
      id: "everest",
      title: "everest - Public Library Commute",
      lyrics: "No one's ever known me better Than you Point the arm sleeve of your sweater To the moon You never letâ€”no. Never let me down Everest. I'm ever restless now Now Now We could stay up all night Yeah We could stay up Maybe, for another few light-years Maybe, for life",
      file: "songs/everest.mp3",
      photoSize: "500px",
    }




];


let currentIndex = 0;
let correctChars = 0;
let startCountdownQueued = null;

function applyTheme(theme) {
  const body = document.body;
  body.classList.toggle("darkmode", theme === "dark");
  localStorage.setItem("theme", theme);
  document.getElementById("theme-overlay").style.display = "none";

  // resume countdown if it was queued
  if (startCountdownQueued) {
    startCountdownQueued();
    startCountdownQueued = null;
  }
}


function startCountdownAndPlay(player) {
  const overlay = document.getElementById("countdown-overlay");

  // Wait if theme not chosen
  if (!localStorage.getItem("theme")) {
    startCountdownQueued = () => startCountdownAndPlay(player);
    document.getElementById("theme-overlay").style.display = "flex";
    return;
  }

  let countdown = 3;
  overlay.textContent = countdown;
  overlay.style.display = 'flex';

  const interval = setInterval(() => {
    countdown--;
    if (countdown > 0) {
      overlay.textContent = countdown;
    } else {
      clearInterval(interval);
      overlay.style.display = 'none';
      player.play().catch(err => console.warn("Playback failed:", err));
    }
  }, 1000);
}

function renderLyrics(lyrics) {
  const container = document.getElementById("lyrics-display");
  container.innerHTML = "";
  for (let char of lyrics) {
    const span = document.createElement("span");
    span.innerHTML = char === " " ? "&nbsp;" : char;
    container.appendChild(span);
  }
}

function updateCursor() {
  const spans = document.querySelectorAll("#lyrics-display span");
  spans.forEach(span => span.classList.remove("cursor"));
  if (currentIndex < spans.length) {
    spans[currentIndex].classList.add("cursor");
    spans[currentIndex].scrollIntoView({
      behavior: "smooth",
      inline: "center",
      block: "nearest"
    });
  }
}

function resetSong() {
  currentIndex = 0;
  correctChars = 0;
  $("#lyrics-display span").removeClass("correct incorrect cursor");
  $("#progress-bar").css("width", "0%");
  updateCursor();
  document.getElementById("ringo-rating").style.display = "none";
document.getElementById("ringo-heads").innerHTML = "";
document.getElementById("ringo-message").textContent = "";


}

function updateProgress() {
  const spans = document.querySelectorAll("#lyrics-display span");
  const percent = (currentIndex / spans.length) * 100;
  document.getElementById("progress-bar").style.width = percent + "%";
}



function handleTyping(event) {
  const spans = document.querySelectorAll("#lyrics-display span");
  if (currentIndex >= spans.length) return;

  const expectedChar = spans[currentIndex].textContent === "\u00A0" ? " " : spans[currentIndex].textContent;
  const typedChar = event.key;

  if (event.ctrlKey || event.altKey || event.metaKey) return;
  if (typedChar.length !== 1 && typedChar !== "Backspace") return;

  if (typedChar === "Backspace") {
    if (currentIndex > 0) {
      currentIndex--;
      if (spans[currentIndex].classList.contains("correct")) correctChars--;
      spans[currentIndex].classList.remove("correct", "incorrect");
    }
    updateCursor();
    updateProgress();
    event.preventDefault();
    return;
  }

  if (typedChar === expectedChar) {
    spans[currentIndex].classList.add("correct");
    spans[currentIndex].classList.remove("incorrect");
    correctChars++;
  } else {
    spans[currentIndex].classList.add("incorrect");
    spans[currentIndex].classList.remove("correct");
  }

  currentIndex++;
  updateCursor();
  updateProgress();
  event.preventDefault();
}


window.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const songId = urlParams.get("song");
  const player = document.getElementById("player");
  document.getElementById("choose-light").addEventListener("click", () => applyTheme("light"));
document.getElementById("choose-dark").addEventListener("click", () => applyTheme("dark"));

// Setup floating theme toggle button
const toggleBtn = document.getElementById("daynite");
if (toggleBtn) {
  toggleBtn.addEventListener("click", () => {
    const currentTheme = document.body.classList.contains("darkmode") ? "dark" : "light";
    const newTheme = currentTheme === "dark" ? "light" : "dark";
    applyTheme(newTheme);
  });
}

// Apply theme from localStorage immediately if present
const storedTheme = localStorage.getItem("theme");
if (storedTheme) applyTheme(storedTheme);


  $("#reset-button").on("click", () => {
    const title = $("#song-title h2").text();
    const song = songs.find(s => s.title === title);
    if (song) loadSong(song);
  });

  if (songId) {
    const song = songs.find(s => s.id === songId);
    if (song) loadSong(song);
  } else {
    loadSong(songs[Math.floor(Math.random() * songs.length)]);
  }

  $("#lyrics-display").attr("tabindex", "0");
  $(document).on("keydown", handleTyping);

  function loadSong(song) {
    const player = document.getElementById("player");

    if (!song.file) {
      player.pause();
      player.removeAttribute("src");
      player.style.display = "none";
      player.load();
      return;
    }

    const isAudio = song.file.toLowerCase().endsWith(".mp3");
    player.pause();
    player.src = song.file;
    player.load();

    if (isAudio) {
      player.style.display = "block";
      player.style.width = song.fileSize || "300px";
      player.style.height = "30px";
    } else {
      player.style.display = "block";
      player.style.width = "100%";
      player.style.maxWidth = song.videoSize || "700px";
    }

    player.onloadeddata = () => {
      startCountdownAndPlay(player);
      // â­ Show Ringo rating when song ends
  player.onended = () => {
    console.log("ðŸŽ¶ Song ended â€” showing Ringo rating");
    showRingoRating();
  };
    };

    $("#song-title").css("text-align", "center").html("<h2>" + song.title + "</h2>");
    $("#typing-container").css("display", "block");

    if (song.photo) {
      $("#song-photo").attr("src", song.photo).css("max-width", song.photoSize || "450px").show();
    } else {
      $("#song-photo").hide();
    }

    renderLyrics(song.lyrics);
    updateCursor();
  
  }
  function showRingoRating() {
    const spans = document.querySelectorAll("#lyrics-display span");
    const total = spans.length;
    const percent = (correctChars / total) * 100;
  
    let ringos = 1;
    let message = "You could use some practice, mate.";
    if (percent >= 80) {
      ringos = 3;
      message = "Pretty fab, drum with me anytime.";
    } else if (percent >= 50) {
      ringos = 2;
      message = "Not bad for a bloke like you.";
    }
  
    const overlay = document.getElementById("ringo-rating");
    const headsDiv = document.getElementById("ringo-heads");
    const messageDiv = document.getElementById("ringo-message");
  
    headsDiv.innerHTML = "";
    messageDiv.textContent = message;
  
    for (let i = 0; i < ringos; i++) {
      const img = document.createElement("img");
      img.src = "images/ringo.avif";
      img.alt = "Ringo Starr";
      img.style.width = "150px";
      img.style.height = "150px";
      img.style.borderRadius = "50%";
      img.style.boxShadow = "0 0 20px rgba(255,255,255,0.7)";
      img.style.transition = "transform 0.3s ease";
      headsDiv.appendChild(img);
    }
  
    overlay.style.display = "flex";
  }
  // Attach button handlers (after overlay is visible)
const homeButton = document.getElementById("home-button");
const replayButton = document.getElementById("replay-button");
const nextButton = document.getElementById("next-button");

if (homeButton) {
  homeButton.onclick = () => window.location.href = "/index.html";
}

if (replayButton) {
  replayButton.onclick = () => {
    document.getElementById("ringo-rating").style.display = "none";
    const title = $("#song-title h2").text();
    const song = songs.find(s => s.title === title);
    if (song) {
      currentIndex = 0;
      correctChars = 0;
      loadSong(song); // uses the existing loadSong() function
    }
  };
}

if (nextButton) {
  nextButton.onclick = () => {
    document.getElementById("ringo-rating").style.display = "none";
    const nextSong = songs[Math.floor(Math.random() * songs.length)];
    currentIndex = 0;
    correctChars = 0;
    loadSong(nextSong);
  };
}

  
  
});